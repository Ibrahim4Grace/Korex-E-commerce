<!DOCTYPE html>
<html lang="en">

<head>
    <title>Korex StyleHub</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Korex StyleHub" name="keywords">
    <meta content="Korex StyleHub" name="description">

      <!-- Favicon -->
      <link href="../img/logo.PNG" rel="icon"> 

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="../lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="../lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="../css/styles.css" rel="stylesheet">

</head>

<body>

     

    <div class="container-xxl position-relative bg-white d-flex p-0">
       
        <!-- Navbar Start -->
     <%- include (`../partials/merchantHeader`); -%>
     <!-- Navbar End -->

                            <!-- Product Start -->
   
     <div class="container-fluid pt-4 px-4">
        <div class="bg-light text-center rounded p-4">
    
            <div class="d-flex align-items-center justify-content-between mb-4">
                <h6 class="mb-0">Products</h6>
                <div class="tab">
                    <a class="tablinks" onclick="openCity(event, 'All')" id="defaultOpen">All</a>
                    <a class="tablinks" onclick="openCity(event, 'In Stock')">In Stock</a>
                    <a class="tablinks" onclick="openCity(event, 'Low Stock')">Low Stock</a>
                    <a class="tablinks" onclick="openCity(event, 'Out of Stock')">Out of Stock</a>
                    <a class="tablinks" onclick="openCity(event, 'Draft')">Draft</a>

                   
                </div>
                <!-- <button type="button" class="btn btn-primary m-2">+ New Product</button> -->
                <button type="button" class="btn btn-primary m-2" id="newProductBtn">+ New Product</button>



                
                <!-- OPEN MODEL END  -->
            </div>
    
            <div id="All" class="tabcontent">
                <h3>All</h3>
                <div class="table-responsive">
                    <table class="table text-start align-middle table-bordered table-hover mb-0">
                        <thead>
                            <tr class="text-dark">
                                <th scope="col"><input class="form-check-input" type="checkbox"></th>
                                <th scope="col">product Image</th>
                                <th scope="col">Product Name</th>
                                <th scope="col">Product Price</th>
                                <th scope="col">shipping Fees</th>
                                <th scope="col">Product Category</th>
                                <th scope="col">Product Brand</th>
                                <th scope="col" style="text-align: center;">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% ourProducts.forEach(products => { %>
                                <tr class="center">
                                    <th scope="col"><input class="form-check-input" type="checkbox"></th>
                                    
                                    <td>
                                        <% if (products.image && products.image.data) { %>
                                            <img src="data:<%= products.image.contentType %>;base64,<%= products.image.data.toString('base64') %>" alt="Products Image">
                                            <% } else { %>
                                                NA
                                        <% } %>
                                    </td>
                                    <td><%= products.productName %></td>
                                    <td><%= products.productPrice %></td>
                                    <td><%= products.productShipping %></td>
                                    <td><%= products.productCategory %></td>
                                    <td><%= products.productBrand %></td>
                                    <td data-label="Profile">
                                              <!-- Edit Button -->
                                        <input type="button" value="Edit" class="btn btn-primary btn-sm edit-button" data-product-id="<%= products._id %>">
                                    
                                              <!-- Delete Button -->
                                        <input type="button" value="Delete" class="btn btn-danger btn-sm delete-button" data-product-id="<%= products._id %>">
                                    </td>
                                </tr>
                                <% }); %>
                            </tbody>
                        </table>
                        <div class="pagination">
                            <% for (let i=1; i <=totalPages; i++) { %>
                                <a href="/merchant/products?page=<%= i %>"
                                    class="<%= currentPage === i ? 'active' : '' %>">
                                    <%= i %>
                                </a>
                            <% } %>
                        </div>
                    </div>
                </div>

                    <script>
                // Function to handle the click event of the edit button
                document.querySelectorAll('.edit-button').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.getAttribute('data-product-id');
                        window.location.href = "/merchant/editProduct/" + productId;
                    });
                });
            
                // Function to handle the click event of the delete button
                document.querySelectorAll('.delete-button').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.getAttribute('data-product-id');
                        window.location.href = "/merchant/deleteProduct/" + productId;
                    });
                });
            </script>

    
            <div id="In Stock" class="tabcontent">
                <h3>In Stock</h3>
                <div class="table-responsive">
                    <table class="table text-start align-middle table-bordered table-hover mb-0">
                        <thead>
                            <tr class="text-dark">
                                <th scope="col"><input class="form-check-input" type="checkbox"></th>
                                <th scope="col">ID</th>
                                <th scope="col">Date</th>
                                <th scope="col">Customer</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Status</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input class="form-check-input" type="checkbox"></td>
                                <td>KS093</td>
                                <td>11 Mar 2024</td>
                                <td>Samson Samuel</td>
                                <td>$123</td>
                                <td>Paid</td>
                                <td><a class="btn btn-sm btn-primary" href="">Detail</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
    
            <div id="Low Stock" class="tabcontent">
                <h3>Low Stock</h3>
                <div class="table-responsive">
                    <table class="table text-start align-middle table-bordered table-hover mb-0">
                        <thead>
                            <tr class="text-dark">
                                <th scope="col"><input class="form-check-input" type="checkbox"></th>
                                <th scope="col">ID</th>
                                <th scope="col">Date</th>
                                <th scope="col">Customer</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Status</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input class="form-check-input" type="checkbox"></td>
                                <td>KS093</td>
                                <td>11 Mar 2024</td>
                                <td>Samson Samuel</td>
                                <td>$123</td>
                                <td>Paid</td>
                                <td><a class="btn btn-sm btn-primary" href="">Detail</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
    
            <div id="Out of Stock" class="tabcontent">
                <h3>Out of Stock</h3>
                <div class="table-responsive">
                    <table class="table text-start align-middle table-bordered table-hover mb-0">
                        <thead>
                            <tr class="text-dark">
                                <th scope="col"><input class="form-check-input" type="checkbox"></th>
                                <th scope="col">ID</th>
                                <th scope="col">Date</th>
                                <th scope="col">Customer</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Status</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input class="form-check-input" type="checkbox"></td>
                                <td>KS093</td>
                                <td>11 Mar 2024</td>
                                <td>Samson Samuel</td>
                                <td>$123</td>
                                <td>Paid</td>
                                <td><a class="btn btn-sm btn-primary" href="">Detail</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
    
            <div id="Draft" class="tabcontent">
                <h3>Draft</h3>
                <div class="table-responsive">
                    <table class="table text-start align-middle table-bordered table-hover mb-0">
                        <thead>
                            <tr class="text-dark">
                                <th scope="col"><input class="form-check-input" type="checkbox"></th>
                                <th scope="col">ID</th>
                                <th scope="col">Date</th>
                                <th scope="col">Customer</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Status</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input class="form-check-input" type="checkbox"></td>
                                <td>KS093</td>
                                <td>11 Mar 2024</td>
                                <td>Samson Samuel</td>
                                <td>$123</td>
                                <td>Paid</td>
                                <td><a class="btn btn-sm btn-primary" href="">Detail</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
          
            <!-- Product End -->

        
     <!-- Footer Start -->
     <%- include (`../partials/merchantFooter`); -%>
     <!-- Footer End -->

     <!-- Modal HTML -->
     <form id="productForm" action="/merchant/merchantProductsPost" method="post" enctype="multipart/form-data">
	<div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
            

				         <!-- Modal Header  (1/3) -->
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h3 id="myModalLabel">Add New Product</h3>
                    </div>

			         <!-- Modal Body (2/3) -->
                    <div class="modal-body" id="serviceModalMultiStep">
					         <!-- Progress Bar -->
					    <div class="progress">
                            <div class="progress-bar progress-bar-success progress-bar-striped active" 
                                role="progressbar" aria-valuenow="1" aria-valuemin="1" aria-valuemax="4" style="width: 20%;">
                            </div>
                        </div>

					         <!-- Tab Steps-->
					    <div class="navbar" style="display: block;">
                            <div class="navbar-inner">
                                <ul class="nav nav-tabs nav-justified">
                                    <li class="active">
                                        <a href="#step1" data-toggle="tab" data-step="1">Information</a>
                                    </li>
                                    <li>
                                        <a href="#step2" data-toggle="tab" data-step="2">Specifications</a>
                                    </li>
                                    <li>
                                        <a href="#step3" data-toggle="tab" data-step="3">Image</a>
                                    </li>
								
                                </ul>
                            </div>
                        </div>

					         <!-- Tab Content -->
					    <div class="tab-content">
					         	<!-- Tab 1 -->
						    <div class="tab-pane fade in active" id="step1">
                                <div class="well">
                                    <label>Product Name</label>
                                    <input type="text" class="form-control" name="productName" placeholder="Enter product name" required>
                                    <div id="productNameError" class="error"></div>
								
                                    <br>
                                    <label>Product Description</label>
                                    <textarea  name="productDescription" class="form-control input-lg" rows="5">
                                        Enter product description
                                    </textarea>
                                    <div id="productDescriptionError" class="error"></div>
                                    <br>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="size">Product Price ($)</label>
                                            <input type="number" name="productPrice" class="form-control" placeholder="Item price." >
                                            <div id="productPriceError" class="error"></div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="color">Product Shipping ($)</label>
                                            <input type="number" name="productShipping" class="form-control" placeholder="Enter Shipping Fees." >
                                            <div id="productShippingError" class="error"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

					         	<!-- Tab 2 -->
						    <div class="tab-pane fade" id="step2">
                                <div class="well">

                                    <div class="row">
                                        <div class="col-md-6">
                                            <% const productCategory = ["Baby Dress","Blazers", "Dresses","Jackets","Jeans","Jumpsuits","loafers", "Shirts","Sleepwears","Sneakers","Sportwears","Swimwears"]; %>
                                            <label for="color">Product Category</label>
                                            <select  name="productCategory" class="form-control backColor">
                                                <option value="">Select product category</option>
                                                <% productCategory.forEach((category )=> { %>
                                                    <option value="<%- category  %>"><%- category  %></option>
                                                 <% }) %>
                                            </select>
                                            <div id="productCategoryError" class="error"></div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="color">Product brand</label>
                                            <input type="text" name="productBrand" class="form-control" placeholder="Enter product brand">
                                            <div id="productBrandError" class="error"></div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <% const productSize = ["XS","S", "M", "L", "XL", "2XL", "3XL", "4XL"]; %>
                                            <label for="size">Sizes</label>
                                            <select id="size" name="productSize" class="form-control backColor">
                                                <option value="">Select Product Sizes</option>
                                                <% productSize.forEach((size )=> { %>
                                                    <option value="<%- size  %>"><%- size  %></option>
                                                    <% }) %>
                                                </select>
                                                <div id="productSizeError" class="error"></div>
                                            </div>
                                            <div class="col-md-6">
                                                <% const productColor = ["Black", "Rusty Red", "Olive Green", "Dark Green",
                                                "Navy Blue", "Indigo", "Charcoal", "Maroon", "Neon Orange","Khaki","Forest Green",
                                                "Dark Cyan","Blue","Slate Blue", "Gray", "Red", "Orange","Lime Green", "Sage Green",
                                                "Sky Blue", "Royal Blue","Purple", "Dark Gray", "Pink","Yellow","Light Yellow", 
                                                "Light Green","Light Blue", "Light Sky Blue","Silver","Light Pink","Peach",
                                                "Pale Yellow", "Light Lime","Light Cyan", "Light Purple", "White" ]; %>
                                                <label for="color">Colors</label>
                                                <select name="productColor" class="form-control backColor">
                                                    <option value="">Select product color</option>
                                                    <% productColor.forEach((colors )=> { %>
                                                        <option value="<%- colors  %>"><%- colors  %></option>
                                                    <% }) %>
                                                </select>
                                                <div id="productColorError" class="error"></div>
                                            </div>
                                        </div><br>

                                        <div class="row">
                                             <!-- <div class="col-md-6">
                                                 <% const genderType = ["Unisex","Male", "Female"]; %>
                                                 <label for="color">Gender</label>
                                                 <select id="color" name="productGender" class="form-control">
                                                     <option value="">Select Country</option>
                                                     <% genderType.forEach((gender )=> { %>
                                                         <option value="<%- gender  %>"><%- gender  %></option>
                                                     <% }) %>
                                                 </select>
                                             </div> -->
                                             <div class="col-md-6">
                                                <label for="color">Quantity</label>
                                                <input type="number" name="productQuantity" class="form-control">
                                                <div id="productQuantityError" class="error"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

						         <!-- Tab 3 -->
						        <div class="tab-pane fade" id="step3">
                                    <div class="well">
                                        <section>
                                            <div class="container">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Upload Item Image</label>
                                                            <div class="preview-zone hidden">
                                                                <div class="box box-solid">
                                                                    <div class="box-header with-border">
                                                                        <div><b>Preview</b></div>
                                                                        <div class="box-tools pull-right">
                                                                        </div>
                                                                    </div>
                                                                    <div class="box-body"></div>
                                                                </div>
                                                            </div>
                                                            <div class="dropzone-wrapper">
                                                                <div class="dropzone-desc">
                                                                    <i class="glyphicon glyphicon-download-alt"></i>
                                                                    <p>Choose an image file or drag it here.</p>
                                                                </div>
                                                                <input type="file" name="images" class="dropzone" multiple>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                  
                                                <!-- <div class="row">
                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-primary pull-right">Upload</button>
                                                    </div>
                                                </div> -->
                                            </div>
                                        </section>
                                    </div>
                                </div>
                            </div>
                        </div>

				         <!-- Modal Footer (3/3) -->
                        <div class="modal-footer" style="margin: 1px auto;">
                            <div class="left-footer">
                                <a class="btn btn-success first" href="#">Start over</a>
                            </div>
                            <div class="right-footer">
                                <a class="btn btn-default back" href="#">Back</a>
                                <a class="btn btn-default next" href="#">Next</a>
                                <button type="submit" class="btn-primary">Submit</button>
                            </div>
                        </div>
                    </div>
             
		    </div>
	</div>
</form>

    
<script>
    $(document).ready(function() {
    // Function to open the modal when the button is clicked
    $("#newProductBtn").click(function() {
        $('#myModal').modal('show'); // Show the modal
    });

    let nStep = 3;
    let firstTab = $("#myModal .tab-pane:first-child").attr("id");
    let lastTab = $("#myModal .tab-pane:last-child").attr("id");

    $("#myModal .progress-bar").text("Step 1 of " + nStep);
    $("#myModal .back, #myModal .first").hide();

    // Manually trigger the shown.bs.tab event for the first tab
    $('[href="#' + firstTab + '"]').tab("show").trigger('shown.bs.tab');

    $("#myModal .next").click(function() {
        // Validate current step before proceeding
        if (!validateStep()) return false;

        let currentTab = $("#myModal .tab-pane.active");
        let nextId = currentTab.next().attr("id");
        $("#myModal [href='#" + nextId + "']").tab("show");

        $("#myModal .back, #myModal .first").css("display", "unset");
        if (nextId === lastTab) {
            $("#myModal .next").hide();
            $("#myModal .right-footer .btn-primary").show(); // Show the submit button
        }
        return false;
    });

    $("#myModal .back").click(function() {
        let currentTab = $("#myModal .tab-pane.active");
        let backId = currentTab.prev().attr("id");
        $("#myModal [href='#" + backId + "']").tab("show");

        $("#myModal .next").css("display", "unset");
        if (backId === "step1") {
            $("#myModal .back, #myModal .first").css("display", "none");
        }
        if (backId !== lastTab) {
            $("#myModal .right-footer .btn-primary").hide(); // Hide the submit button
        }
        return false;
    });

    $('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
        let step = $(e.target).data("step");
        let percent = parseInt(step) / nStep * 100;

        $("#myModal .progress-bar").css({ width: percent + "%" });
        $("#myModal .progress-bar").text("Step " + step + " of " + nStep);

        // Check if the current tab is the "Upload Image" tab
        if ($(e.target).attr("href") === "#step3") {
            $("#myModal .right-footer .btn-primary").show(); // Show the submit button
            $("#myModal .next").hide(); // Hide the next button
        } else {
            $("#myModal .right-footer .btn-primary").hide(); // Hide the submit button
            $("#myModal .next").show(); // Show the next button
        }
    });

    $("#myModal .first").click(function() {
        $("#myModal [href='#" + firstTab + "']").tab("show");
        $("#myModal .back, #myModal .first").css("display", "none");
        $("#myModal .next").css("display", "unset");
        $("#myModal .right-footer .btn-primary").hide(); // Hide the submit button
    });

    // Form submission logic
    $("#productForm").submit(function(event) {
        // Prevent the default form submission
        event.preventDefault();

        // Validate all steps before submission
        if (!validateStep()) return false;

        // Collect form data including files
        var formData = new FormData(this);

        // Send the data to the server
        $.ajax({
            url: '/merchant/merchantProductsPost', 
            type: 'POST',
            data: formData,
            processData: false, // Prevent jQuery from processing the data
            contentType: false, // Prevent jQuery from setting content type
            success: function(response) {
                if (response.success) {
                    window.location.href = "/merchant/products";
                } else {
                    // If registration failed, display error messages
                    const errors = response.errors;
                    errors.forEach(error => {
                        const errorElement = document.getElementById(`${error.key}Error`);
                        if (errorElement) {
                            errorElement.textContent = error.msg;
                        }
                    });
                }
            },
            error: function(xhr, status, error) {
                // Handle error
                console.error(xhr.responseText);
                alert('An error occurred while processing your request.');
            }
        });
    });

    // Function to validate current step
    function validateStep() {
        let currentTab = $("#myModal .tab-pane.active");
        let inputs = currentTab.find('input, select');

        let valid = true;
        inputs.each(function() {
            if (!$(this).val()) {
                valid = false;
                let fieldName = $(this).attr('name');
                let errorElement = document.getElementById(fieldName + 'Error');
                if (errorElement) {
                    errorElement.textContent = 'Please fill out this field.';
                }
            }
        });

        return valid;
    }

    // Add event listener to each input field to clear error messages
    const inputFields = document.querySelectorAll('input, select'); // Get all input and select fields
    inputFields.forEach(inputField => {
        inputField.addEventListener('input', () => {
            const fieldName = inputField.name;
            const errorElement = document.getElementById(fieldName + 'Error');
            if (errorElement) {
                // Clear the error message associated with the input field
                errorElement.innerText = '';
            }
        });
    });
});

</script>
     <!-- Item image uploading using file reader  -->
     <script>
        $(document).ready(function() {
    function readFile(input) {
        if (input.files && input.files[0]) {
            let reader = new FileReader();
            reader.onload = function(e) {
                let htmlPreview =
                    '<div class="image-preview">' +
                        '<img width="100" src="' + e.target.result + '" />' +
                        '<button type="button" class="btn btn-danger btn-sm remove-image">Remove</button>' +
                    '</div>';
                let boxZone = $(input).parents('.form-group').find('.preview-zone').find('.box').find('.box-body');
                boxZone.append(htmlPreview);
            };
            reader.readAsDataURL(input.files[0]);
        }
    }reset

    function reset(e) {
        e.wrap('<form>').closest('form').get(0).reset();
        e.unwrap();
    }

    $(".dropzone").change(function() {
        let input = this;
        if (input.files && input.files[0]) {
            for (let i = 0; i < input.files.length; i++) {
                readFile(input);
            }
        }
    });

    $('.dropzone-wrapper').on('dragover', function(e) {
        e.preventDefault();
        e.stopPropagation();
        $(this).addClass('dragover');
    });

    $('.dropzone-wrapper').on('dragleave', function(e) {
        e.preventDefault();
        e.stopPropagation();
        $(this).removeClass('dragover');
    });

    $('.preview-zone').on('click', '.remove-image', function() {
        $(this).parent('.image-preview').remove();
    });

});

    </script>


</body>

</html>